---
title: "Problem_Set_3"
author: "Amy Richardson"
date: "3/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Initiate packages
```{r}
library(ggplot2)
library(tidyr)
library (dplyr)
library(granova)
library(car)
library(Rcmdr)
library(pastecs)
library(multcomp)
library(compute.es)
library(WRS2)
```


Read in Data
```{r}
sat_df <- read.csv("SAT.csv", header = TRUE)
```

Change Character columns (Race.Ethnicity and Sex) to factors.
```{r}
sat_df <- sat_df %>% mutate(Sex_factor = as.factor(Sex))
sat_df <- sat_df %>% mutate(Race_factor = as.factor(Race.Ethnicity))
sat_df <- sat_df %>% mutate(MATH = as.numeric(MATH))
```

***
## Part 1
There is no difference between scores on the English section of the SAT among racial/ethnic groups. 

Plot histograms of English Scores among racial/ethnic groups - NOT DONE
```{r}
sat_df %>%
  ggplot(aes(x = ERW, fill = Race_factor)) +
  geom_histogram () +
  facet_grid(Race_factor ~.) 
  


hist_satMath <- ggplot(sat_df, aes (MATH))+ theme(legend.position = "none") +
  geom_histogram(color = "black", fill = "white", binwidth = 10) +
  labs(title = "Histogram of SAT Math Scores", x = "Math Scores", y = "Density")

hist_satMath
```


Method 1: histogram - NOT DONE
```{r}
data_gen_df %>% 
  ggplot(aes(x = study_hrs, fill = discipline)) +
  geom_histogram() + 
  facet_grid(discipline ~ .) +
  labs(title = "Histogram of student average weekly study hours by major",
       x ="Study hours",
       y = "Count") +
  theme(plot.title = element_text(hjust = 0.5))
```


Method 2: boxplots - NOT DONE
```{r}
data_gen_df %>% 
  ggplot(aes(x = discipline, y = study_hrs)) +
  geom_boxplot() +
  labs(title = "Boxplot of student average weekly study hours by major",
       x ="Major",
       y = "Average student study hours") +
  theme(plot.title = element_text(hjust = 0.5))

```




Run ANOVA
```{r}
anova_model <- aov(ERW ~ Race_factor, data = sat_df)
summary(anova_model)

```

Levene's Test
```{r}
leveneTest(sat_df$ERW, sat_df$Race_factor, center = median)
```


Welch Test
```{r}
oneway.test(ERW ~ Race_factor, data = sat_df)
```

Effect Sizes - NOT DONE copied from Week 9 Practice
```{r}
summary.lm(anova_model)

```




Make a new data frame with just columns and widen with Race - NOT DONE
```{r}
sat_race_df <- select(sat_df, "Race_factor", "ERW")
```

Convert to wide
```{r}
sat_race_wide <- unstack(sat_race_df, ERW ~ Race_factor)


```



***
## Part 2
The mean of the scores in the sample for the English section on the SAT is 550. (meaning not significantly different from 550)


Run one sample t-test
```{r}
num_3_ttest <- t.test(sat_df$ERW, mu = 550)
num_3_ttest
```

effect size 
```{r}
t<-num_3_ttest$statistic[[1]]
df<-num_3_ttest$parameter[[1]]
r <- sqrt(t^2/(t^2+df))
round(r, 3)
```
statistically the mean does not vary significantly from 550 however practically there is a small effect size (between 0.1 < r < 0.3)


Assumptions for t-test
     + Normality - descriptions and plots
     + Independent - assuming that no one took the test twice
     + continuous - the English scores are continuous
     + Levene's test


Descriptive statistics
```{r}
round(stat.desc(sat_df$ERW, basic = FALSE, norm = FALSE), digits = 3)

```

Histogram of English scores
```{r}
hist_ENG_all <- ggplot(sat_df, aes (ERW))+ theme(legend.position = "none") +
  geom_histogram(color = "black", fill = "white", binwidth = 10) +
  labs(title = "Histogram of SAT English Scores", x = "English Scores", y = "Density")

hist_ENG_all

```

Q-Q Plot of Math scores
```{r}
qqplot.satENG <- qplot(sample = sat_df$ERW, stat="qq")
qqplot.satENG + labs(title = "QQPlot for SAT English Scores", x = "Thoeretical", y = "Sample")
```

***
## Part 3
The observed distribution of values of the mathematics section is approximately normal.  

Descriptive statistics
```{r}
round(stat.desc(sat_df$MATH, basic = FALSE, norm = FALSE), digits = 3)

```


Histogram of Math scores
```{r}
hist_satMath <- ggplot(sat_df, aes (MATH))+ theme(legend.position = "none") +
  geom_histogram(color = "black", fill = "white", binwidth = 10) +
  labs(title = "Histogram of SAT Math Scores", x = "Math Scores", y = "Density")

hist_satMath

```


Q-Q Plot of Math scores
```{r}
qqplot.satMATH <- qplot(sample = sat_df$MATH, stat="qq")
qqplot.satMATH+ labs(title = "QQPlot for SAT Math Scores", x = "Thoeretical", y = "Sample")
```

Cannot run Shapiro Wilk's test since sample size is so big.  Assume data is normally distributed.



***
## Part 4
There is no difference between male and female scores on the mathematics section of the SAT.


Create an errorbar plot
```{r}
mathbar <- ggplot(sat_df, aes(Sex_factor, MATH))
mathbar + stat_summary(fun.y = mean, geom = "bar", fill = "White", colour = "Black") +
  stat_summary(fun.data = mean_cl_normal, geom = "pointrange") + 
  labs(x = "Gender", y = "SAT Math Score") +
    scale_y_continuous(limits = c(0, 900), breaks = seq(from = 0, to = 700, by = 100))



```

Independent t-test for Math Scores comparing Genders
```{r}
ind.t.test <- t.test(MATH ~ Sex_factor, data = sat_df)
ind.t.test
```

Effect sizes
```{r}
t<-ind.t.test$statistic[[1]]
df<-ind.t.test$parameter[[1]]
r <- sqrt(t^2/(t^2+df))
round(r, 3)
```


***
## Part 5
There is no relationship between the sex of the test-taker and whether the test-taker completed the essay component. 

Method:  Pearson's Chi-Squared Test

Run Pearson's Chi-squared Test
```{r}
CrossTable(sat_df$Sex, sat_df$Took.Essay., fisher = TRUE, chisq = TRUE, expected = TRUE, prop.c = FALSE, prop.t = FALSE, prop.chisq = FALSE,  sresid = TRUE, format = "SPSS")
```




















